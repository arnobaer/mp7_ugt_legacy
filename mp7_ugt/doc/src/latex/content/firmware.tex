%------------------------------------------------------------------------------
%
% Repository path   : $HeadURL: https://hbergauer@forge.hephy.oeaw.ac.at/scm/svn/project-cmstrigger/GlobalTriggerUpgrade/doc/latex/gt-mp7-firmware-specification/content/firmware.tex $
% Last committed    : $Revision: 4401 $
% Last changed by   : $Author: hbergauer $
% Last changed date : $Date: 2016-11-03 14:48:50 +0100 (Thu, 03 Nov 2016) $
% Description       : firmware
% ------------------------------------------------------------------------------
\section{Firmware overview}\label{sec:fw}

The figure \ref{fig:mgt} shows the architecture of \ugt. It consists of framework , SERDES, Tx, IPBus, \rop and the ALGORITHM LOGIC, which it consists of the following modules:
\begin{enumerate}
\item \ugtl
\item \ufdl
\end{enumerate}

\rop is responsible sending the Read-out record over \gbe to AMC13, which will be sent it from there to DAQ.
 
The IPBus system allows the control of hardware via a ‘virtual bus’, using a standard IP-over-gigabit-Ethernet network connection (section [\ref{sec:ipbus}]).
\begin{figure}[h!]
   \centering
    \includegraphics[width=1.0\textwidth]{figures/mGT_firmware}
    \caption{\ugt firmware. It consists of framework, SERDES module, ALGORITHM LOGIC, ROP and IPBus. The \rop is the module, which is responsible to send the \record to  AMC13.}\label{fig:mgt}
 \end{figure}
 
Moreover the \verb|Tx_AMC13| should be instanitate for sending the readout-record to AMC13. This part is outside of framework functionality.

\clearpage

%------------------------------------------------------------------------------
%
%  LHC data Packagee
%
% ------------------------------------------------------------------------------

\subsection{Package: lhc\_data\_pkg} \label{section_lhc_data_pkg}
% \textbf{\textit{Under construction!!!}}

The VHDL record \texttt{lhc\_data\_t} (shown in Listing \ref{lst_lhc_data_t}) is used as a container for all object streams processed by the system. It is declared in the VHDL package \texttt{lhc\_data\_pkg}.
% This package is auto-generated by the python script \texttt{lhc\_data\_pkg\_generator} from the XML specification in Listing \ref{lst_lhc_data_t_xml}. The script generates the record type, converter functions (to/from \texttt{std\_logic\_vector}) and various constants used by other modules in the system. 
For debugging and simulation purposes a second package (\texttt{lhc\_data\_debug\_util\_pkg}) is created which contains functions to convert the \texttt{lhc\_data\_t} to a hexadecimal string representation and vice versa. The testbench of the design uses this functions to load the contents of the SIM memory from a file. 

\lstinputlisting[label=lst_lhc_data_t,language=VHDL,caption=lhc\_data\_t record specification]{interfaces/lhc_data_t.vhd}

% \lstinputlisting[label=lst_lhc_data_t_xml,language=XML,caption=lhc\_data\_t xml specification]{../../../firmware/gt_amc514/trunk/xml/lhc_data_t.xml}
% 

\clearpage
